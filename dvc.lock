schema: '2.0'
stages:
  transpose:
    cmd: python src/data/select_region.py data/raw/all_v2.csv data/interim/data_regional.csv
      2661
    deps:
    - path: data/raw/all_v2.csv
      md5: 00af12733984c983b49f412cef232a9f
      size: 408179741
    - path: src/data/select_region.py
      md5: 34da5d0ba8c5b0a3b97121f4780807aa
      size: 809
    outs:
    - path: data/interim/data_regional.csv
      md5: 985bf5b3d1ac2dfac93e2f5b991296b5
      size: 36542699
  select_region:
    cmd: python src/data/select_region.py data/raw/all_v2.csv data/interim/data_regional.csv
      2661
    deps:
    - path: data/raw/all_v2.csv
      md5: 00af12733984c983b49f412cef232a9f
      size: 408179741
    - path: src/data/select_region.py
      md5: a10209ac98a43fb10cfffab4bce14cb0
      size: 795
    outs:
    - path: data/interim/data_regional.csv
      md5: ce43fe511dd122670f536b2ef3d26136
      size: 32927996
  clean_data:
    cmd: python src/data/clean_data.py data/interim/data_regional.csv data/interim/data_cleaned.csv
    deps:
    - path: data/interim/data_regional.csv
      md5: ce43fe511dd122670f536b2ef3d26136
      size: 32927996
    - path: src/data/clean_data.py
      md5: 006d70387010dbdf1c31d043d18421ef
      size: 1760
    outs:
    - path: data/interim/data_cleaned.csv
      md5: 21fbc2b09585f36054af2042322794ad
      size: 28625253
  add_features:
    cmd: python src/features/add_features.py data/interim/data_cleaned.csv data/interim/data_featured.csv
    deps:
    - path: data/interim/data_cleaned.csv
      md5: 21fbc2b09585f36054af2042322794ad
      size: 28625253
    - path: src/features/add_features.py
      md5: db51bf3074135298ab337f7711da7891
      size: 950
    outs:
    - path: data/interim/data_featured.csv
      md5: dd7c81ad9953d567e2dc8c3200909bef
      size: 35930251
  get_osm_cafes_data:
    cmd: python src/data/get_osm_cafes_data.py "https://maps.mail.ru/osm/tools/overpass/api/interpreter?data=[out:json];nwr['addr:street'='Лиговский
      проспект']['addr:housenumber'=101];node[amenity=cafe](around:25000);out geom;"
      data/external/data_cafes.geojson
    deps:
    - path: src/data/get_osm_cafes_data.py
      md5: d2c8fed42242aa69c52e18153d69b4c6
      size: 828
    outs:
    - path: data/external/data_cafes.geojson
      md5: 404d95d65a5a1530e91983653bf93862
      size: 1235291
  add_cafes_in_radius:
    cmd: python src/features/add_cafe_radius_features.py data/interim/data_featured.csv
      data/external/data_cafes.geojson data/processed/dataset.csv
    deps:
    - path: data/external/data_cafes.geojson
      md5: 404d95d65a5a1530e91983653bf93862
      size: 1235291
    - path: data/interim/data_featured.csv
      md5: dd7c81ad9953d567e2dc8c3200909bef
      size: 35930251
    - path: src/features/add_cafe_radius_features.py
      md5: 75777111f48c1d74d41d033ad9378167
      size: 1927
    outs:
    - path: data/processed/dataset.csv
      md5: 5e44baba17cfc8d0aefcfbfe37c27ccd
      size: 53966724
  prepare_datasets:
    cmd: python src/models/prepare_datasets.py data/processed/dataset.csv data/processed/train.csv
      data/processed/test.csv
    deps:
    - path: data/processed/dataset.csv
      md5: 5e44baba17cfc8d0aefcfbfe37c27ccd
      size: 53966724
    - path: src/models/prepare_datasets.py
      md5: 4b1b8ffd978ea2e2cf54cdcc34c8eef0
      size: 888
    outs:
    - path: data/processed/test.csv
      md5: 3a0cfa4e35a13bab6051815ee8f58983
      size: 6821730
    - path: data/processed/train.csv
      md5: 8eb7a1663ad890c4b159d3a95a35fd80
      size: 20465736
  train:
    cmd: python src/models/train.py data/processed/train.csv data/processed/test.csv
      models/model.clf
    deps:
    - path: data/processed/test.csv
      md5: 3a0cfa4e35a13bab6051815ee8f58983
      size: 6821730
    - path: data/processed/train.csv
      md5: 8eb7a1663ad890c4b159d3a95a35fd80
      size: 20465736
    - path: src/models/train.py
      md5: d69a3774883905d89bf9604236f6e950
      size: 1631
    outs:
    - path: models/model.clf
      md5: 9e6459662ef660bcc26f01b6f711c07a
      size: 11551397
  evaluate:
    cmd: python src/models/evaluate.py data/processed/test.csv models/model.clf reports/scores.csv
    deps:
    - path: models/model.clf
      md5: 9e6459662ef660bcc26f01b6f711c07a
      size: 11551397
    - path: src/models/evaluate.py
      md5: 99449e447db18785500fb7d2e41b7c42
      size: 982
    outs:
    - path: reports/scores.csv
      md5: 394da5afab210426ed35fd12f3f516a0
      size: 47
